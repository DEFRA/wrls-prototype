
{% extends "layout.html" %}

{% set title = "Charge information valid from" %}
  {% set chargeInfoNumber = [data.chargeInfoNumber] %}

{% block pageTitle %}
   {{title}} - GOV.UK
{% endblock %}

{% block header %}
 {{ govukHeader({
   homepageUrl: "/",
   serviceName: "Manage your water abstraction or impoundment licence",
   serviceUrl: "#",
   containerClasses: "govuk-width-container",
   navigation: [
     {
       href: "#1",
       text: "Change password"
     },
     {
       href: "/",
       text: "Sign out"
     }
   ]
 }) }}
{% endblock %}

{% block beforeContent %}

  <!-- navigation block -->
  <div class="govuk-!-margin-bottom-6">
    <!-- navigation block -->
    {% include "includes/nav/nav-bd-view.html" %}
  </div>

  {{ govukBackLink({
    text: "Back",
    href: "javascript:history.back()"
  }) }}

{% endblock %}

{% block content %}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    <!-- page heading -->
    <span class="govuk-caption-l">Licence 03/28/60/0032</span>
    <h1 class="govuk-heading-l">

      <span class="screen-reader-only">Current</span> {{ title }} <br> {{[data.chargeVersions[chargeInfoNumber].chargeStart]}}
    </h1>
    <!-- <a href="" class="wrls-faux-button wrls-faux-button--secondary">Change start date</a> -->

    <p class="govuk-body">
      {% if [data.chargeVersions[chargeInfoNumber].chargeStatus] == "CHARGEABLE" %}
      {{govukTag({
      text: "Approved",
      classes: "govuk-tag--green govuk-!-font-size-27"
    })}}
    {% elif [data.chargeVersions[chargeInfoNumber].chargeStatus] == "INVALID" %}
    {{govukTag({
    text: "INVALID",
    classes: "govuk-tag--red govuk-!-font-size-27"
  })}}
  {% elif [data.chargeVersions[chargeInfoNumber].chargeStatus] == "REPLACED" %}
  {{govukTag({
  text: "Replaced",
  classes: "govuk-tag--grey govuk-!-font-size-27"
})}}
{% elif [data.chargeVersions[chargeInfoNumber].chargeStatus] == "NOT APPROVED" %}
{{govukTag({
text: "Review",
classes: "govuk-tag--orange govuk-!-font-size-27"
})}}
{% elif [data.chargeVersions[chargeInfoNumber].chargeStatus] == "CHANGES" %}
{{govukTag({
text: "Change requested",
classes: "govuk-tag--blue govuk-!-font-size-27"
})}}
{% endif %}
    </p>



    {% if [data.chargeVersions[chargeInfoNumber].free] == "true" %}
    {% elif [data.chargeVersions[chargeInfoNumber].chargeStatus] == "NOT APPROVED" %}
    {% elif [data.chargeVersions[chargeInfoNumber].chargeStatus] == "CHANGES" %}
    {% else %}
    <div class="govuk-grid-row govuk-!-margin-bottom-3">
      <div class="govuk-grid-column-full">
        <section class="meta-data__row">
          <div class="meta-data__container">
            <div class="meta-data__label">
              Reason
            </div>
            <div class="meta-data__value">
              {{data.chargeVersions[chargeInfoNumber].reasonNewCharge}}
            </div>
            <div>
        </section>
        <section class="meta-data__row">
          <div class="meta-data__container">
            <div class="meta-data__label">
              Billed up to
            </div>
            <div class="meta-data__value">

              {{data.chargeVersions[chargeInfoNumber].chargeBilledDate}}
            </div>
            <div>
        </section>

        </div>
        </div>
        {% endif %}
      </div>
      </div>


      <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">


          {% if ([data.chargeInfoNumber] == "0") and ([data.chargeVersions[chargeInfoNumber].chargeStatus] == "CHANGES") %}
          <h2 class="govuk-heading-m">
            Comments from Billing and Data
          </h2>
          <p class="govuk-body govuk-!-margin-bottom-9">{{data['requestChanges']}}</p>
          {% endif %}

          {% if (([data.chargeInfoNumber] == "0") and ([data.chargeVersions[chargeInfoNumber].chargeStatus] == "NOT APPROVED")) or (([data.chargeInfoNumber] == "0") and ([data.chargeVersions[chargeInfoNumber].chargeStatus] == "CHANGES")) %}
          {% include "includes/bd/reason-new-charge.html" %}
          <section class="govuk-!-margin-bottom-9">
            <h2 class="govuk-heading-m govuk-!-margin-bottom-0">Charge start date</h2>

          {{ govukSummaryList({
          rows: [
            {
              classes: 'govuk-summary-list__row--last',
              key: {
                text: "Start date"
              },
              value: {
                text: [data.chargeVersions[chargeInfoNumber].chargeStart]
              },
              actions: {
                items: [
                  {
                    href: "set-charge-start-date",
                    text: "Change",
                    visuallyHiddenText: "name"
                  }
                ]
              }
            }
          ]
          }) }}

          </section>
          {% endif %}

{% if [data.chargeVersions[chargeInfoNumber].free] == "true" %}
<p class="govuk-bod govuk-!-margin-top-6">This licence was made free of charge on {{data.chargeVersions[chargeInfoNumber]['chargeStart']}}.</p>
{{ govukSummaryList({
  classes: 'govuk-summary-list--no-border',
  rows: [
    {
      key: {
        text: "Reason"
      },
      value: {
        text: data['reason']
      }
    }
  ]
}) }}
{% elif ([data.chargeInfoNumber] == "0") and ([data.chargeVersions[chargeInfoNumber].chargeStatus] == "NOT APPROVED") %}
{% include "includes/bd/elements-change.html" %}
{% set y = data['chargeStart-year'] | int %}
{% set m = data['chargeStart-month'] | int %}
{% set d = data['chargeStart-day'] | int %}
{% set date = y + m + d %}
{% if date < 2045 %}
{{ govukWarningText({
 text: "Approving this charge version will give older charge information an 'Invalid' status.",
 iconFallbackText: "Warning"
}) }}
{% endif%}
{{ govukButton({
  text: "Approve",
  classes: "govuk-!-margin-right-1",
  href: "confirm-approve-charge-information"
}) }}

{{ govukButton({
  text: "Request changes",
  classes: "govuk-button--secondary",
  href: "request-changes"
}) }}
{% elif ([data.chargeInfoNumber] == "0") and ([data.chargeVersions[chargeInfoNumber].chargeStatus] == "CHANGES") %}


<form action="/bd/charges-2020/charge-version/charge-data-check" method="post" class="form">

{% include "includes/bd/elements-change.html" %}
{{ govukButton({
  text: "Confirm changes",
  classes: "govuk-!-margin-right-1"
}) }}

{{ govukButton({
  text: "Remove charge information",
  classes: "govuk-button--secondary",
  href: "/bd/charges-2020/charge-version/confirm-remove-charge-information"
}) }}

</form>

{% else %}
{% include "includes/bd/elements-historic.html" %}
{% endif %}

</div>
</div>

{% endblock %}
